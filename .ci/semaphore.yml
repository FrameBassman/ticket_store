# .ci/semaphore.yml
version: v1.0
name: Deployment to staging pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Deploy to staging on heroku
    task:
      secrets:
        - name: Heroku
        - name: private-repo
      jobs:
        - name: Build and deploy
          commands:
              # Install heroku
            - curl https://cli-assets.heroku.com/install.sh | sh
            - heroku --version
              # Setup ssh
            - chmod 600 ~/.ssh/
            # - ssh-add ~/.ssh/*
            - checkout
            - cd Services
            - heroku container:login
            - heroku container:push web --app staging-chertopolokh
            - heroku container:push release --app staging-chertopolokh
